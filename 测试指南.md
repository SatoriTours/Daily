# 🧪 Daily Satori 应用测试指南

## 🎯 快速开始

### 快速开始 - 使用统一测试脚本

```bash
# 每日开发 - 快速测试（推荐）
./test.sh

# 或指定测试类型
./test.sh quick      # 快速测试（默认）
./test.sh basic      # 基础集成测试
./test.sh full       # 完整功能测试（需要配置环境变量）
```

---

## 📋 测试覆盖功能

### ✅ 自动化测试

1. **应用启动测试**
   - 应用正常启动（15秒等待）
   - 底部导航栏显示
   - 导航项（文章、日记、读书）正常

2. **基础组件测试**
   - UI组件渲染
   - 应用响应性
   - 内存稳定性

3. **代码质量检查**
   - `flutter analyze` 静态分析
   - 单元测试

### 🔄 自动化测试步骤（完整功能测试 - `./test.sh full`）

1. **文章功能测试**
   - 自动保存文章到剪贴板（https://blog.tymscar.com/posts/gleamaoc2025/）
   - 从剪贴板导入文章
   - 测试文章刷新功能
   - 测试文章删除功能

2. **日记功能测试**
   - 自动创建测试日记
   - 从相册添加图片
   - 保存日记

3. **书籍功能测试**
   - 搜索并添加"论语"
   - 验证书籍信息

### 🔄 手动测试步骤（备选）

1. **文章刷新功能**
   ```
   选择文章 → 进入详情 → 点击刷新 → 保存
   ```

2. **文章删除功能**
   ```
   选择文章 → 详情页 → 更多选项 → 删除 → 确认
   ```

3. **日记编辑功能**
   ```
   打开日记 → 修改内容 → 添加/删除图片 → 保存
   ```

---

## 🚀 运行命令大全

### 检查环境
```bash
flutter devices          # 查看连接的设备
flutter analyze          # 静态代码分析
```

### 测试脚本选项
```bash
./test.sh              # 快速测试（默认）
./test.sh --check      # 检查测试环境
./test.sh --prepare    # 准备测试环境
./test.sh --help       # 查看帮助
```

### 单独运行测试（高级用法）
```bash
# 单元测试
flutter test

# 集成测试
flutter test integration_test/basic_app_test.dart -d PKJ110

# 完整功能测试（需要配置环境变量）
flutter test integration_test/full_app_test.dart -d PKJ110
```

---

## ⚠️ 注意事项

### 应用启动问题
- **现象**: 第一次启动可能卡在启动页
- **解决**: 重启一次即可恢复正常
- **测试**: 集成测试使用15秒等待时间处理此问题

### 测试限制
- 由于错误处理器冲突，完整UI交互测试暂时无法自动化
- 核心功能（文章、日记、AI等）需要手动测试验证

---

## 🔧 环境变量配置

为了让完整功能测试正常工作，需要配置AI服务环境变量：

### OpenAI（推荐）
```bash
# Linux/macOS
export TEST_AI_URL="https://api.deepseek.com"
export TEST_AI_TOKEN="sk-your-openai-api-key-here"
export TEST_AI_MODEL="deepseek-chat"

# Windows PowerShell
$env:TEST_AI_URL="https://api.deepseek.com"
$env:TEST_AI_TOKEN="sk-your-openai-api-key-here"
$env:TEST_AI_MODEL="deepseek-chat"
```

### 永久配置（Linux/macOS）
```bash
echo 'export TEST_AI_URL="https://api.deepseek.com"' >> ~/.bashrc
echo 'export TEST_AI_TOKEN="sk-your-openai-api-key-here"' >> ~/.bashrc
echo 'export TEST_AI_MODEL="deepseek-chat"' >> ~/.bashrc
source ~/.bashrc
```

**⚠️ 注意**：不要将API Key提交到版本控制系统！

---

## 📁 文件说明

```
test/
├── widget_test.dart           # 单元测试
├── test_helpers.dart          # 测试工具
├── test_config.dart           # 测试配置（AI等）
integration_test/
├── basic_app_test.dart        # 基础集成测试（可用）
├── full_app_test.dart         # 完整功能测试（包含数据初始化）
└── test_utils.dart            # 测试辅助工具
```

---

## 🎮 推荐工作流程

1. **开发阶段**
   ```bash
   ./quick_test.sh  # 每次修改后运行
   ```

2. **功能完成**
   - 手动测试相关功能
   - 运行应用启动测试验证稳定性

3. **发布前**
   ```bash
   ./test.sh full          # 完整测试（包含所有检查）
   ```

---

## 🔧 故障排除

### 测试失败
1. 检查设备连接：`flutter devices`
2. 清理项目：`flutter clean && flutter pub get`
3. 重启adb：`adb kill-server && adb start-server`

### 集成测试问题
- 确保有设备连接或模拟器运行
- 使用较长的等待时间（15秒+）
- 检查应用是否正常启动
- 完整功能测试需要配置环境变量（见 `环境变量配置.md`）

### 环境变量问题
- 确认已配置 `TEST_AI_URL`、`TEST_AI_TOKEN` 和 `TEST_AI_MODEL`
- 验证API Key有效且有余额
- 检查网络连接是否正常

---

**📞 需要帮助？**
- 运行 `./test.sh --help` 查看完整帮助信息
- 查看测试指南或代码注释了解更多详情
